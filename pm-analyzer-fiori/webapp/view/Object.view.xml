<mvc:View
    controllerName="com.sap.pm.pmanalyzerfiori.controller.Object"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.ui.layout.form"
    xmlns:l="sap.ui.layout"
    xmlns:core="sap.ui.core">

    <Page
        id="page"
        title="{i18n>objectTitle}: {NotificationId}"
        showNavButton="true"
        navButtonPress=".onNavBack">
        <content>
            <VBox class="sapUiSmallMargin">
                <Title text="{Description}" class="sapUiSmallMarginBottom" />
                <f:SimpleForm layout="ResponsiveGridLayout">
                    <f:content>
                        <Label text="{i18n>priorityLabel}"/>
                        <ObjectStatus
                            text="{PriorityText}"
                            state="{= ${Priority} === '1' ? 'Error' : ${Priority} === '2' ? 'Warning' : 'None' }" />
                        <Label text="{i18n>notificationTypeLabel}"/>
                        <Text text="{NotificationTypeText}" />
                        <Label text="{i18n>createdByLabel}"/>
                        <Text text="{CreatedByUser}" />
                        <Label text="{i18n>creationDateLabel}"/>
                        <Text text="{path: 'CreationDate', formatter: '.formatter.formatDateTime'}" />
                    </f:content>
                </f:SimpleForm>
            </VBox>
            <IconTabBar
                id="iconTabBar"
                class="sapUiResponsiveContentPadding">
                <items>
                    <IconTabFilter key="notification" text="{i18n>notificationDetailsTab}">
                        
                        <HBox items="{timeline>/notification}" class="sapUiSmallMarginBottom">
                            <VBox class="timelineStep">
                                <customData>
                                    <core:CustomData key="status" value="{timeline>status}" writeToDom="true" />
                                </customData>
                                <HBox justifyContent="Center" alignItems="Center" width="100%">
                                    <Text text="{timeline>text}" class="timelineText"/>
                                    <core:Icon
                                        src="sap-icon://accept"
                                        class="sapUiTinyMarginBegin"
                                        visible="{= ${timeline>status} === 'completed' }" />
                                </HBox>
                            </VBox>
                        </HBox>

                        <f:SimpleForm layout="ResponsiveGridLayout" class="sapUiLargeMarginTop">
                            <f:content>
                                <Label text="{i18n>functionalLocationLabel}"/>
                                <Text text="{FunctionalLocation}" />
                                <Label text="{i18n>equipmentLabel}"/>
                                <Text text="{EquipmentNumber}" />
                                <Label text="{i18n>requiredStartLabel}"/>
                                <Text text="{path: 'RequiredStartDate', formatter: '.formatter.formatDateTime'}" />
                                <Label text="{i18n>requiredEndLabel}"/>
                                <Text text="{path: 'RequiredEndDate', formatter: '.formatter.formatDateTime'}" />
                                <Label text="{i18n>malfunctionStartLabel}"/>
                                <Text text="{path: 'MalfunctionStartDate', formatter: '.formatter.formatDateTime'}" />
                                <Label text="{i18n>malfunctionEndLabel}"/>
                                <Text text="{path: 'MalfunctionEndDate', formatter: '.formatter.formatDateTime'}" />
                                <Label text="{i18n>longTextLabel}"/>
                                <Text text="{LongText}" />
                            </f:content>
                        </f:SimpleForm>
                        <f:SimpleForm title="{i18n>codesLabel}" layout="ResponsiveGridLayout">
                            <f:content>
                                <Label text="{i18n>damageLabel}"/>
                                <Text text="{Damage/Text} ({Damage/CodeGroup} - {Damage/Code})" />
                                <Label text="{i18n>causeLabel}"/>
                                <Text text="{Cause/Text} ({Cause/CodeGroup} - {Cause/Code})" />
                            </f:content>
                        </f:SimpleForm>
                    </IconTabFilter>

                    <IconTabFilter key="workOrder" text="{i18n>workOrderTab}" visible="{= !!${WorkOrder} }">
                        
                        <HBox items="{timeline>/workOrder}" class="sapUiSmallMarginBottom">
                            <VBox class="timelineStep">
                                <customData>
                                    <core:CustomData key="status" value="{timeline>status}" writeToDom="true" />
                                </customData>
                                <HBox justifyContent="Center" alignItems="Center" width="100%">
                                    <Text text="{timeline>text}" class="timelineText"/>
                                    <core:Icon
                                        src="sap-icon://accept"
                                        class="sapUiTinyMarginBegin"
                                        visible="{= ${timeline>status} === 'completed' }" />
                                </HBox>
                            </VBox>
                        </HBox>

                        <f:SimpleForm layout="ResponsiveGridLayout" class="sapUiLargeMarginTop">
                            <f:content>
                                <Label text="{i18n>orderIdLabel}"/>
                                <Text text="{WorkOrder/OrderId}" />
                                <Label text="{i18n>descriptionLabel}"/>
                                <Text text="{WorkOrder/Description}" />
                                <Label text="{i18n>orderTypeLabel}"/>
                                <Text text="{WorkOrder/OrderTypeText}" />
                                <Label text="{i18n>workCenterLabel}"/>
                                <Text text="{WorkOrder/WorkCenter}" />
                                <Label text="{i18n>plannerGroupLabel}"/>
                                <Text text="{WorkOrder/PlannerGroup}" />
                                <Label text="{i18n>basicStartDateLabel}"/>
                                <Text text="{path: 'WorkOrder/BasicStartDate', formatter: '.formatter.formatDateTime'}" />
                                <Label text="{i18n>basicEndDateLabel}"/>
                                <Text text="{path: 'WorkOrder/BasicEndDate', formatter: '.formatter.formatDateTime'}" />
                            </f:content>
                        </f:SimpleForm>
                        <Table
                            headerText="{i18n>operationsHeader}"
                            items="{WorkOrder/Operations}">
                            <columns>
                                <Column><Text text="{i18n>operationColumn}" /></Column>
                                <Column><Text text="{i18n>descriptionColumn}" /></Column>
                                <Column><Text text="{i18n>workCenterColumn}" /></Column>
                                <Column hAlign="End"><Text text="{i18n>durationColumn}" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <Text text="{OperationNumber}" />
                                        <Text text="{Description}" />
                                        <Text text="{WorkCenter}" />
                                        <Text text="{Duration} {DurationUnit}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </IconTabFilter>

                    <IconTabFilter key="analysis" text="{i18n>qualityAnalysisTab}">
                        <VBox class="sapUiSmallMargin" busy="{analysis>/busy}">
                            <Title text="{i18n>qualityScoreLabel}" class="sapUiSmallMarginTopBottom" />
                            <ProgressIndicator
                                percentValue="{analysis>/score}"
                                displayValue="{analysis>/score}%"
                                state="{= ${analysis>/score} > 70 ? 'Success' : (${analysis>/score} >= 50 ? 'Warning' : 'Error') }"
                                class="sapUiSmallMarginBottom" />
                            
                            <f:SimpleForm layout="ResponsiveGridLayout">
                                <f:content>
                                    <Label text="{i18n>summaryLabel}"/>
                                    <Text text="{analysis>/summary}" />
                                    <Label text="{i18n>problemsLabel}"/>
                                    <Text text="{path: 'analysis>/problems', formatter:'.formatter.formatProblems'}" renderWhitespace="true" />
                                </f:content>
                            </f:SimpleForm>

                            <Label text="{i18n>whatIfAnalysisLabel}" class="sapUiSmallMarginTopBottom" />
                            <TextArea id="longTextForAnalysis" value="{LongText}" rows="8" width="100%" />
                            <Button text="{i18n>reanalyzeButtonText}" type="Emphasized" press=".onReanalyze" class="sapUiSmallMarginTop"/>
                        </VBox>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </content>
    </Page>
</mvc:View>
